(function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/Evented","helpers/extentFactory","helpers/popupHelper","helpers/symbolHelper","helpers/IdentifyHelper","esri/dijit/BasemapGallery","esri/layers/osm"],function(a,b,c,d,e,f,g,h){var i=a([c],{map:null,_handlers:[],render:function(){var a=d.losAngeles();this.map=new esri.Map("map",{infoWindow:e.create(),extent:a});var c=new esri.layers.OpenStreetMapLayer,f="http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Census_USA/MapServer",i=new esri.layers.ArcGISDynamicMapServiceLayer(f,{id:"censusLayer"});i.title="Census Data",i.identifyLayers=[1,3,4,5];var j=[],k=this,l=b.connect(this.map,"onLayersAddResult",function(a){b.disconnect(l);var c=[],d=a.length;while(d--)typeof a[d].error=="undefined"&&(c[c.length]=a[d]);if(i.loaded){j[j.length]=i;var e=new g;e.identifyHandler(k.map,j)}var f=new h({showArcGISBasemaps:!0,map:k.map}),m=b.connect(f,"onLoad",function(){b.disconnect(m),f.select(f.basemaps[f.basemaps.length-1].id),k.emit("mapIsReady",{map:k.map,layers:c,operational:j,bmg:f})})}),m=[c,i];return this.map.addLayers(m),this._handlers[this._handlers.length]=b.connect(window,"resize",function(){k.map.resize()}),this}});return i})}).call(this)