(function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/Deferred","dojo/DeferredList","helpers/templateBuilder","esri/tasks/identify"],function(a,b,c,d,e){var f=function(a){var b=a.feature;return b.attributes.layerName=a.layerName,b.layerName=a.layerName,e.buildInfoTemplate(b)},g=function(a){var b=[];for(var c=0,d=a.length;c<d;c++){var e=new esri.tasks.IdentifyTask(a[c].url);e.identifyLayers=a[c].identifyLayers,b[b.length]=e}return b},h=function(a){var b=[];for(var d=0,e=a.length;d<e;d++)b[b.length]=new c;return b},i=a([],{identifyHandler:function(a,c){var e=new esri.tasks.IdentifyParameters;e.tolerance=3,e.returnGeometry=!0,e.layerOption=esri.tasks.IdentifyParameters.LAYER_OPTION_ALL;var i=function(b){var c=[];for(var d=0,g=b.length;d<g;d++)b[d][0]&&(c=c.concat(b[d][1]));for(var h=0,i=c.length;h<i;h++)c[h]=f(c[h]);return c.length===0?a.infoWindow.clearFeatures():a.infoWindow.setFeatures(c),a.infoWindow.show(e.geometry),c};b.connect(a,"onClick",function(b){var f=g(c),j=h(f),k=new d(j);k.then(i),e.geometry=b.mapPoint,e.mapExtent=a.extent,e.width=a.width,e.height=a.height;for(var l=0,m=f.length;l<m;l++)try{e.layerIds=f[l].identifyLayers;var n=f[l].execute(e,j[l].callback,j[l].errback)}catch(o){console.log(o),j[l].errback(o)}})}});return i})}).call(this)